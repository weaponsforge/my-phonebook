(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[192],{8719:function(t,e,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/contacts",function(){return r(2342)}])},8534:function(t,e,r){"use strict";r.d(e,{Z:function(){return x}});var a=r(5893),n=r(7294),i=r(1163),l=r(1638),s=r(7357),c=r(3972),o=r(6489),d=r(5077),u=function(t){let{children:e}=t;return(0,a.jsx)(s.Z,{sx:{width:{sm:"600px"},backgroundColor:{xs:"none",sm:"rgba(255, 255, 255, 0.4)"},borderRadius:"8px",textAlign:"center",margin:"24px !important",padding:"24px",display:"grid",placeContent:"center"},children:e})},p=r(3367),h=function(t){let{authError:e}=t,r=(0,p.e6)("activeTheme");return(0,a.jsx)(d.Z,{children:(0,a.jsx)(s.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",placeContent:"center",height:"100vh"},children:(0,a.jsxs)(u,{children:[(0,a.jsx)("span",{children:(0,a.jsx)(c.Z,{variant:"h6",color:"#000",children:"Loading..."})}),(0,a.jsx)("span",{children:(0,a.jsx)(o.Z,{color:"light"===r?"dark":"primary"})}),e&&(0,a.jsx)(c.Z,{variant:"label",color:"error",children:e})]})})})},x=function(t){return function(e){let r=(0,i.useRouter)(),{authLoading:s,authUser:c,authError:o}=(0,l.C0)("auth");return(0,n.useEffect)(()=>{s||null!==c||r.push("/login")},[c,s,r]),s?(0,a.jsx)(h,{}):c?(0,a.jsx)(t,{...e}):(0,a.jsx)(h,{authError:o})}}},2012:function(t,e,r){"use strict";r.d(e,{Z:function(){return o}});var a=r(5893),n=r(7294),i=r(9397),l=r(9820),s=r(4799),c=r(594);function o(t){let{message:e,closeHandler:r}=t,[o,d]=(0,n.useState)(!0),u=(t,e)=>{"clickaway"!==e&&(d(!1),r&&r())},p=(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.Z,{color:"secondary",size:"small",onClick:u,children:"UNDO"}),(0,a.jsx)(s.Z,{size:"small","aria-label":"close",color:"inherit",onClick:u,children:(0,a.jsx)(c.Z,{fontSize:"small"})})]});return(0,a.jsx)("div",{children:(0,a.jsx)(l.Z,{open:o,autoHideDuration:6e3,onClose:u,message:e,action:p,sx:{maxWidth:600}})})}},9361:function(t,e,r){"use strict";r.d(e,{l:function(){return i}});var a=r(5893),n=r(8441);let i=()=>(0,a.jsx)(n.Z,{sx:{position:"fixed",width:"100%"}})},7488:function(t,e,r){"use strict";r.d(e,{q:function(){return o}});var a=r(2037),n=r(4924),i=r(7297),l=r(3247),s=r(9825);function c(){let t=(0,i.Z)(["(?<segment>[^/]+)"]);return c=function(){return t},t}class o{static async createDoc(t,e){switch(!0){case(0,a.Z)(this,o,p).call(o,t):{let r=(0,l.JU)(this.db,t),a=r.id;e.id&&delete e.id;let n=await (0,l.pl)(r,{...e,doc_id:a,date_created:(0,l.Bt)(),date_updated:(0,l.Bt)()});return n}case(0,a.Z)(this,o,u).call(o,t):{let r=(0,l.hJ)(this.db,t),a=(0,l.JU)(r),n=a.id;e.id&&delete e.id;let i=await (0,l.pl)(a,{...e,doc_id:n,date_created:(0,l.Bt)(),date_updated:(0,l.Bt)()});return i}}}static async readDoc(t){if(!(0,a.Z)(this,o,p).call(o,t))return;let e=(0,l.JU)(this.db,t),r=await (0,l.QT)(e),n=r.data();return n}static async readCol(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];if(!(0,a.Z)(this,o,u).call(o,t))return;let i=(0,l.hJ)(this.db,t),s=(0,l.IO)(i,...r),c=await (0,l.PL)(s),d=c.docs.map(t=>({...t.data()}));return d}static async readColGroup(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];if(1!==(0,a.Z)(this,o,d).call(o,t))return;let i=(0,l.B$)(this.db,t),s=(0,l.IO)(i,...r),c=await (0,l.PL)(s),u=c.docs.map(t=>({...t.data()}));return u}static async updateDoc(t,e){if(!(0,a.Z)(this,o,p).call(o,t))return;let r=(0,l.JU)(this.db,t),n=await (0,l.r7)(r,{...e,date_updated:(0,l.Bt)()});return n}static async deleteDoc(t){if(!(0,a.Z)(this,o,p).call(o,t))return;let e=(0,l.JU)(this.db,t),r=await (0,l.oe)(e);return r}static async subscribeDoc(t,e){if(!(0,a.Z)(this,o,p).call(o,t))return;let r=(0,l.JU)(this.db,t),n=(0,l.cf)(r,e);return n}static async subscribeCol(t,e){for(var r=arguments.length,n=Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];if(!(0,a.Z)(this,o,u).call(o,t))return;let s=(0,l.hJ)(this.db,t),c=(0,l.IO)(s,...n),d=(0,l.cf)(c,e);return d}}(0,n.Z)(o,"db",(0,l.ad)(s.H));var d={writable:!0,value:t=>{let e=t.match(RegExp(String.raw(c()),"gi")).length;return e}},u={writable:!0,value:t=>{let e=(0,a.Z)(o,o,d).call(o,t);return 0!==e&&e%2==1}},p={writable:!0,value:t=>{let e=(0,a.Z)(o,o,d).call(o,t);return 0!==e&&e%2==0}};(0,n.Z)(o,"generateDocId",t=>{let e=(0,l.JU)((0,l.hJ)(o.db,t));return e.id}),(0,n.Z)(o,"subscribeColGroup",async function(t,e){for(var r=arguments.length,n=Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];if(1!==(0,a.Z)(o,o,d).call(o,t))return;let s=(0,l.B$)(o.db,t),c=(0,l.IO)(s,...n),u=(0,l.cf)(c,e);return u})},1018:function(t,e,r){"use strict";r.d(e,{C_:function(){return l},kX:function(){return s},vJ:function(){return i}});var a=r(9825),n=r(6650);let i=async function(t,e,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=(0,n.iH)(a.tO,"".concat(t,"/").concat(r));try{await (0,n.KV)(l,e,{customMetadata:i})}catch(t){throw Error(t)}return await (0,n.Jt)(l)},l=async t=>{let{pathToStorageDirectory:e,pathToStorageFile:r,fileName:i,allowMissingError:l=!1}=t,s=null!=r?r:"".concat(e,"/").concat(i),c=(0,n.iH)(a.tO,"".concat(s));if(!l)return await (0,n.oq)(c);try{let t=await (0,n.oq)(c);return t}catch(t){return!0}},s=async t=>{let e=(0,n.iH)(a.tO,t);return await (0,n.Br)(e)}},2342:function(t,e,r){"use strict";r.r(e),r.d(e,{default:function(){return K}});var a=r(5893),n=r(8534),i=r(5077),l=r(9361),s=r(7357),c=r(1638),o=r(7297),d=r(3972),u=r(1018),p=r(2734),h=r(1987),x=r(7952),f=r(1163);function m(){let t=(0,o.Z)(["(?<firstNameInitial>^[a-z])"]);return m=function(){return t},t}function g(){let t=(0,o.Z)(["(?<middleNameInitial>^[a-z])"]);return g=function(){return t},t}function b(){let t=(0,o.Z)(["(?<lastNameInitial>^[a-z])"]);return b=function(){return t},t}let j=(t,e,r)=>{var a,n,i;let l=(null!==(a=t.match(RegExp(String.raw(m()),"i")))&&void 0!==a?a:[""])[0],s=(null!==(n=e.match(RegExp(String.raw(g()),"i")))&&void 0!==n?n:[""])[0],c=(null!==(i=r.match(RegExp(String.raw(b()),"i")))&&void 0!==i?i:[""])[0];return"".concat(l).concat(s).concat(c)},v=t=>{let e=0;for(let r=0;r<t.length;r++)e+=t.charCodeAt(r);return e%255},Z=t=>{let{contact:e}=t,r=(0,f.useRouter)(),n=(0,p.Z)(),{data:i}=(0,c.Oc)("public_picture.".concat(JSON.stringify(e.profile_picture_url)),async()=>{let t=await (0,u.kX)(e.profile_picture_url),r=URL.createObjectURL(t);return r}),l=j(e.first_name,e.middle_name,e.last_name).toUpperCase(),s=v(l),o=t=>{t.stopPropagation(),r.push("/contacts/edit/".concat(e.doc_id)),(0,c.cA)("show.sidebar",!1)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(h.Z,{elevation:5,sx:{backgroundColor:"inherit",backdropFilter:"blur(2px)",display:{xs:"none",md:"grid"},gridTemplateColumns:"1fr 6fr",gridAutoRows:"1fr",padding:"15px",gap:"15px",alignItems:"center",borderRadius:"10px",width:"auto",maxWidth:"80vw","&:hover":{backdropFilter:"contrast(120%)"}},onClick:o,children:[(0,a.jsx)(x.Z,{sx:{backgroundColor:"hsla(".concat(s,",50%,80%,50%)"),border:"1px solid grey"},src:i,children:l}),(0,a.jsxs)(d.Z,{variant:"h8",sx:{color:n.palette.primary,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[e.first_name," ",e.middle_name," ",e.last_name]})]}),(0,a.jsxs)(h.Z,{elevation:0,sx:{backgroundColor:"inherit",backdropFilter:"blur(2px)",display:{xs:"grid",md:"none"},gridTemplateColumns:"1fr 6fr",gridAutoRows:"1fr",padding:"15px",gap:"15px",alignItems:"center",borderRadius:"10px",width:"auto",maxWidth:"80vw","&:hover":{backdropFilter:"contrast(120%)"}},onClick:o,children:[(0,a.jsx)(x.Z,{sx:{backgroundColor:"hsla(".concat(s,",50%,80%,50%)"),border:"1px solid grey"},src:i,children:l}),(0,a.jsxs)(d.Z,{variant:"h8",sx:{color:n.palette.primary,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[e.first_name," ",e.middle_name," ",e.last_name]})]})]})},y=t=>{let{content:e}=t,{group:r,contacts:n}=e;return(0,a.jsxs)(s.Z,{sx:{display:"grid",gridTemplateColumns:"40px 1fr",p:"25px",borderBottom:"1px dashed grey"},children:[(0,a.jsx)(d.Z,{variant:"h4",sx:{padding:"15px",paddingLeft:"0",aspectRatio:"1",position:"sticky",top:0},children:"misc"===r?"":r}),(0,a.jsx)(s.Z,{sx:{backgroundColor:"inherit",display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(250px, 1fr))",alignItems:"start",gap:"10px",flex:"1"},children:n.map((t,e)=>(0,a.jsx)(Z,{contact:t},e))})]})};function w(){let t=(0,o.Z)(["(?<firstLetterChar>^[a-z])|"]);return w=function(){return t},t}let C=()=>{let{data:t,error:e}=(0,c.ay)("contacts"),r=[...null!=t?t:[]].reduce((t,e)=>{let r=e.first_name.match(RegExp(String.raw(w()),"i"))[0];return r?(t[r.toUpperCase()]||(t[r.toUpperCase()]=[]),t[r.toUpperCase()]=[...t[r.toUpperCase()],e]):(t.misc||(t.misc=[]),t.misc=[...t.misc,e]),t},{}),n=Object.entries(r);return(0,a.jsxs)(s.Z,{sx:{width:"100%",height:"100%"},children:[t&&n.map((t,e)=>(0,a.jsx)(y,{content:{group:t[0],contacts:t[1]}},e)),e&&(0,a.jsx)("div",{children:"Error"})]})};var _=r(7294);let k={first_name:"Matching First Name",middle_name:"Matching Middle Name",last_name:"Matching Last Name",phone_number:"Matching Contact Number",email_address:"Matching Contact Email"},E=t=>{let{content:e}=t,{group:r,contacts:n}=e;if(k[r])return(0,a.jsxs)(s.Z,{sx:{display:"grid",gridTemplateColumns:"1fr",padding:"20px",borderBottom:"1px dashed grey"},children:[(0,a.jsx)(d.Z,{variant:"h5",sx:{},children:k[r]}),(0,a.jsx)(s.Z,{sx:{backgroundColor:"inherit",display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(250px, 1fr))",alignItems:"start",gap:"10px",flex:"1"},children:n.map((t,e)=>(0,a.jsx)(Z,{contact:t},e))})]})};function R(){let t=(0,o.Z)(["",""]);return R=function(){return t},t}let{Box:U}=r(3105),O=(t,e)=>{let r=[...e].reduce((e,r)=>{for(let[a,n]of Object.entries(r))RegExp(String.raw(R(),t),"i").test(n)&&(e[a]||(e[a]=[]),e[a]=[...e[a],r]);return e},{});return r},I=()=>{let t=(0,c.C0)("ui.search.searchKeyword"),e=(0,c.C0)("contacts.data"),r=O(t,e);delete r.doc_id,delete r.profile_picture_url,delete r.date_updated,delete r.date_created,(0,c.cA)("data.searchResults",r);let n=Object.entries(r);return(0,_.useEffect)(()=>{if(1===n.length)for(let[,t]of n)(0,c.cA)("ui.activeContact",t[0]),(0,c.cA)("ui.phase.editContact",!0)},[n]),(0,a.jsx)(U,{sx:{width:"100%",height:"100%"},children:(0,a.jsx)(U,{children:n.map((t,e)=>(0,a.jsx)(E,{content:{group:t[0],contacts:t[1]}},e))})})},A=()=>{let t=(0,c.C0)("ui.phase");return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(s.Z,{sx:{flex:6.8,maxWidth:"1600px",justifyContent:"center",width:"100%",overflowY:"scroll",userSelect:"none"},children:(null==t?void 0:t.search)?(0,a.jsx)(I,{}):(0,a.jsx)(C,{})})})};var S=function(){let{loading:t}=(0,c.ay)("contacts");return(0,a.jsxs)(i.Z,{children:[t&&(0,a.jsx)(l.l,{}),(0,a.jsx)(s.Z,{sx:{flex:1,display:"flex",flexWrap:"wrap",overflowY:"scroll",userSelect:"none",justifyContent:"center"},children:(0,a.jsx)(A,{})})]})},B=r(2443),J=r(3640),N=r(8061),z=r(847),F=r(5993),T=r(9397),D=r(6154),L=r(7488),W=r(9825);let P=async t=>{let e;let r={...t};try{e=await W.I8.currentUser.getIdToken(!0)}catch(t){throw Error(t.message)}return e?r.headers.Authorization="Bearer ".concat(e):r.headers.Authorization="",r},M=async t=>{let{body:e,params:r}=t,a={headers:{}};return e&&(a.data=e),r&&(a.params=r),await P(a)};var H=r(3247);let X=async t=>{if(!t)return;let{responseType:e="arraybuffer",type:r="csv",ids:a}=t,n=await M({body:{type:r,ids:a}});return await (0,D.Z)({...n,url:"".concat("https://myphonebook-app.vercel.app","/api/contacts/export"),method:"POST",responseType:e})};var q=r(2012),G=r(6489);let V=()=>{let t=(0,B.u)(),[e,r]=(0,_.useState)("csv"),[n,i]=(0,_.useState)("all_contacts"),{data:l,loading:o,error:u}=(0,c.ay)("exportfile"),p=(0,_.useMemo)(()=>!o&&l&&!1===u?l:null,[o,l,u]);(0,_.useEffect)(()=>{if(p){let t=p.headers["content-type"],e=new Blob([p.data],{type:t}),r=document.createElement("a");r.href=URL.createObjectURL(e),r.setAttribute("download",decodeURI("contacts")),document.body.appendChild(r),r.click(),document.body.removeChild(r)}},[p]);let x=async()=>{let t={type:e};if("search_results"===n){var r,a,i;t.ids=null!==(i=null===(r=(0,c.zr)("data.searchResults"))||void 0===r?void 0:null===(a=r.sorting)||void 0===a?void 0:a.map(t=>t.doc_id))&&void 0!==i?i:[]}(0,c.Gt)("exportfile",async()=>X(t))},f=()=>{(0,c.cA)("show.exportPopup",!1),(0,c.cA)("exportfile")},m=t=>{r(t.target.value)},g=t=>{i(t.target.value)};return(0,a.jsxs)(s.Z,{id:"popupBackground",sx:{position:"fixed",zIndex:"100",top:"0",left:"0",right:"0",bottom:"0",background:"inherit",backdropFilter:"blur(5px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:t=>{"popupBackground"===t.target.id&&f()},children:[(0,a.jsxs)(h.Z,{elevation:5,sx:{padding:"30px",borderRadius:"20px",zIndex:"200",display:"flex",flexDirection:"column",backgroundColor:"hsla(10,100%,100%,50%)",maxWidth:"320px",gap:"10px"},children:[(0,a.jsx)(d.Z,{children:"Export contacts"}),(0,a.jsx)(J.Z,{disabled:o,children:(0,a.jsxs)(N.Z,{"aria-labelledby":"demo-radio-buttons-group-label",defaultValue:"google_csv",name:"radio-buttons-group",onChange:g,value:n,children:[(0,a.jsx)(z.Z,{value:"all_contacts",control:(0,a.jsx)(F.Z,{}),label:"All contacts"}),(0,a.jsx)(z.Z,{value:"search_results",control:(0,a.jsx)(F.Z,{}),label:"Search results"})]})}),(0,a.jsxs)(J.Z,{disabled:o,children:[(0,a.jsx)(d.Z,{children:"Export as"}),(0,a.jsxs)(N.Z,{"aria-labelledby":"demo-radio-buttons-group-label",defaultValue:"google_csv",name:"radio-buttons-group",onChange:m,value:e,children:[(0,a.jsx)(z.Z,{value:"csv",control:(0,a.jsx)(F.Z,{}),label:"CSV File"}),(0,a.jsx)(z.Z,{value:"pdf",control:(0,a.jsx)(F.Z,{}),label:"PDF File"})]})]}),(0,a.jsxs)(s.Z,{sx:{display:"flex",justifyContent:"flex-end"},children:[(0,a.jsx)(T.Z,{variant:"text",disabled:o,sx:{color:t.palette.primary.dark,fontWeight:"bold",minWidth:"77px"},onClick:f,children:"Cancel"}),(0,a.jsx)(T.Z,{variant:"text",disabled:o,sx:{color:t.palette.primary.dark,fontWeight:"bold",minWidth:"77px"},onClick:x,children:o?(0,a.jsx)(G.Z,{size:24}):(0,a.jsx)("span",{children:"Export"})})]})]}),"boolean"!=typeof u&&(null==u?void 0:u.message)!==""&&(0,a.jsx)(q.Z,{message:null==u?void 0:u.message})]})};var K=(0,n.Z)(function(){let t=(0,c.C0)("auth"),e=(0,c.C0)("show.exportPopup");return(0,_.useEffect)(()=>{L.q.subscribeCol("users/".concat(t.authUser.uid,"/contacts"),t=>{let e=[];t.forEach(t=>{e.push(t.data())}),(0,c.Gt)("contacts",()=>e)},(0,H.Xo)("sorting"))},[t.authUser.uid]),(0,a.jsxs)(a.Fragment,{children:[e&&(0,a.jsx)(V,{}),(0,a.jsx)(S,{})]})})}},function(t){t.O(0,[642,101,548,154,105,77,774,888,179],function(){return t(t.s=8719)}),_N_E=t.O()}]);
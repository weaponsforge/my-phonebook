(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[192],{8719:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/contacts",function(){return r(2342)}])},8534:function(e,t,r){"use strict";r.d(t,{Z:function(){return x}});var a=r(5893),n=r(7294),i=r(1163),l=r(2092),s=r(7357),c=r(3972),o=r(6489),d=r(5077),u=function(e){let{children:t}=e;return(0,a.jsx)(s.Z,{sx:{width:{sm:"600px"},backgroundColor:{xs:"none",sm:"rgba(255, 255, 255, 0.4)"},borderRadius:"8px",textAlign:"center",margin:"24px !important",padding:"24px",display:"grid",placeContent:"center"},children:t})},p=r(3367),h=function(e){let{authError:t}=e,r=(0,p.e)("activeTheme");return(0,a.jsx)(d.Z,{children:(0,a.jsx)(s.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",placeContent:"center",height:"100vh"},children:(0,a.jsxs)(u,{children:[(0,a.jsx)("span",{children:(0,a.jsx)(c.Z,{variant:"h6",color:"#000",children:"Loading..."})}),(0,a.jsx)("span",{children:(0,a.jsx)(o.Z,{color:"light"===r?"dark":"primary"})}),t&&(0,a.jsx)(c.Z,{variant:"label",color:"error",children:t})]})})})},x=function(e){return function(t){let r=(0,i.useRouter)(),{authLoading:s,authUser:c,authError:o}=(0,l.C0)("auth");return(0,n.useEffect)(()=>{s||null!==c||r.push("/login")},[c,s,r]),s?(0,a.jsx)(h,{}):c?(0,a.jsx)(e,{...t}):(0,a.jsx)(h,{authError:o})}}},2012:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var a=r(5893),n=r(7294),i=r(9397),l=r(9820),s=r(4799),c=r(594);function o(e){let{message:t,closeHandler:r}=e,[o,d]=(0,n.useState)(!0),u=(e,t)=>{"clickaway"!==t&&(d(!1),r&&r())},p=(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.Z,{color:"secondary",size:"small",onClick:u,children:"UNDO"}),(0,a.jsx)(s.Z,{size:"small","aria-label":"close",color:"inherit",onClick:u,children:(0,a.jsx)(c.Z,{fontSize:"small"})})]});return(0,a.jsx)("div",{children:(0,a.jsx)(l.Z,{open:o,autoHideDuration:6e3,onClose:u,message:t,action:p,sx:{maxWidth:600}})})}},7488:function(e,t,r){"use strict";r.d(t,{q:function(){return o}});var a=r(2037),n=r(4924),i=r(7297),l=r(3247),s=r(9825);function c(){let e=(0,i.Z)(["(?<segment>[^/]+)"]);return c=function(){return e},e}class o{static async createDoc(e,t){switch(!0){case(0,a.Z)(this,o,p).call(o,e):{let r=(0,l.JU)(this.db,e),a=r.id;t.id&&delete t.id;let n=await (0,l.pl)(r,{...t,doc_id:a,date_created:(0,l.Bt)(),date_updated:(0,l.Bt)()});return n}case(0,a.Z)(this,o,u).call(o,e):{let r=(0,l.hJ)(this.db,e),a=(0,l.JU)(r),n=a.id;t.id&&delete t.id;let i=await (0,l.pl)(a,{...t,doc_id:n,date_created:(0,l.Bt)(),date_updated:(0,l.Bt)()});return i}}}static async readDoc(e){if(!(0,a.Z)(this,o,p).call(o,e))return;let t=(0,l.JU)(this.db,e),r=await (0,l.QT)(t),n=r.data();return n}static async readCol(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];if(!(0,a.Z)(this,o,u).call(o,e))return;let i=(0,l.hJ)(this.db,e),s=(0,l.IO)(i,...r),c=await (0,l.PL)(s),d=c.docs.map(e=>({...e.data()}));return d}static async readColGroup(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];if(1!==(0,a.Z)(this,o,d).call(o,e))return;let i=(0,l.B$)(this.db,e),s=(0,l.IO)(i,...r),c=await (0,l.PL)(s),u=c.docs.map(e=>({...e.data()}));return u}static async updateDoc(e,t){if(!(0,a.Z)(this,o,p).call(o,e))return;let r=(0,l.JU)(this.db,e),n=await (0,l.r7)(r,{...t,date_updated:(0,l.Bt)()});return n}static async deleteDoc(e){if(!(0,a.Z)(this,o,p).call(o,e))return;let t=(0,l.JU)(this.db,e),r=await (0,l.oe)(t);return r}static async subscribeDoc(e,t){if(!(0,a.Z)(this,o,p).call(o,e))return;let r=(0,l.JU)(this.db,e),n=(0,l.cf)(r,t);return n}static async subscribeCol(e,t){for(var r=arguments.length,n=Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];if(!(0,a.Z)(this,o,u).call(o,e))return;let s=(0,l.hJ)(this.db,e),c=(0,l.IO)(s,...n),d=(0,l.cf)(c,t);return d}}(0,n.Z)(o,"db",(0,l.ad)(s.H));var d={writable:!0,value:e=>{let t=e.match(RegExp(String.raw(c()),"gi")).length;return t}},u={writable:!0,value:e=>{let t=(0,a.Z)(o,o,d).call(o,e);return 0!==t&&t%2==1}},p={writable:!0,value:e=>{let t=(0,a.Z)(o,o,d).call(o,e);return 0!==t&&t%2==0}};(0,n.Z)(o,"generateDocId",e=>{let t=(0,l.JU)((0,l.hJ)(o.db,e));return t.id}),(0,n.Z)(o,"subscribeColGroup",async function(e,t){for(var r=arguments.length,n=Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];if(1!==(0,a.Z)(o,o,d).call(o,e))return;let s=(0,l.B$)(o.db,e),c=(0,l.IO)(s,...n),u=(0,l.cf)(c,t);return u})},1018:function(e,t,r){"use strict";r.d(t,{C_:function(){return l},kX:function(){return s},vJ:function(){return i}});var a=r(9825),n=r(6650);let i=async function(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=(0,n.iH)(a.tO,"".concat(e,"/").concat(r));try{await (0,n.KV)(l,t,{customMetadata:i})}catch(e){throw Error(e)}return await (0,n.Jt)(l)},l=async e=>{let{pathToStorageDirectory:t,pathToStorageFile:r,fileName:i,allowMissingError:l=!1}=e,s=null!=r?r:"".concat(t,"/").concat(i),c=(0,n.iH)(a.tO,"".concat(s));if(!l)return await (0,n.oq)(c);try{let e=await (0,n.oq)(c);return e}catch(e){return!0}},s=async e=>{let t=(0,n.iH)(a.tO,e);return await (0,n.Br)(t)}},2342:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return V}});var a=r(5893),n=r(8534),i=r(5077),l=r(7357),s=r(2092),c=r(7297),o=r(3972),d=r(1018),u=r(2734),p=r(1987),h=r(7952),x=r(1163);function f(){let e=(0,c.Z)(["(?<firstNameInitial>^[a-z])"]);return f=function(){return e},e}function m(){let e=(0,c.Z)(["(?<middleNameInitial>^[a-z])"]);return m=function(){return e},e}function g(){let e=(0,c.Z)(["(?<lastNameInitial>^[a-z])"]);return g=function(){return e},e}let b=(e,t,r)=>{var a,n,i;let l=(null!==(a=e.match(RegExp(String.raw(f()),"i")))&&void 0!==a?a:[""])[0],s=(null!==(n=t.match(RegExp(String.raw(m()),"i")))&&void 0!==n?n:[""])[0],c=(null!==(i=r.match(RegExp(String.raw(g()),"i")))&&void 0!==i?i:[""])[0];return"".concat(l).concat(s).concat(c)},j=e=>{let t=0;for(let r=0;r<e.length;r++)t+=e.charCodeAt(r);return t%255},v=e=>{let{contact:t}=e,r=(0,x.useRouter)(),n=(0,u.Z)(),{data:i}=(0,s.Oc)("public_picture.".concat(JSON.stringify(t.profile_picture_url)),async()=>{let e=await (0,d.kX)(t.profile_picture_url),r=URL.createObjectURL(e);return r}),l=b(t.first_name,t.middle_name,t.last_name).toUpperCase(),c=j(l),f=e=>{e.stopPropagation(),r.push("/contacts/edit/".concat(t.doc_id)),(0,s.cA)("show.sidebar",!1)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(p.Z,{elevation:5,sx:{backgroundColor:"inherit",backdropFilter:"blur(2px)",display:{xs:"none",md:"grid"},gridTemplateColumns:"1fr 6fr",gridAutoRows:"1fr",padding:"15px",gap:"15px",alignItems:"center",borderRadius:"10px",width:"auto",maxWidth:"80vw","&:hover":{backdropFilter:"contrast(120%)"}},onClick:f,children:[(0,a.jsx)(h.Z,{sx:{backgroundColor:"hsla(".concat(c,",50%,80%,50%)"),border:"1px solid grey"},src:i,children:l}),(0,a.jsxs)(o.Z,{variant:"h8",sx:{color:n.palette.primary,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[t.first_name," ",t.middle_name," ",t.last_name]})]}),(0,a.jsxs)(p.Z,{elevation:0,sx:{backgroundColor:"inherit",backdropFilter:"blur(2px)",display:{xs:"grid",md:"none"},gridTemplateColumns:"1fr 6fr",gridAutoRows:"1fr",padding:"15px",gap:"15px",alignItems:"center",borderRadius:"10px",width:"auto",maxWidth:"80vw","&:hover":{backdropFilter:"contrast(120%)"}},onClick:f,children:[(0,a.jsx)(h.Z,{sx:{backgroundColor:"hsla(".concat(c,",50%,80%,50%)"),border:"1px solid grey"},src:i,children:l}),(0,a.jsxs)(o.Z,{variant:"h8",sx:{color:n.palette.primary,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[t.first_name," ",t.middle_name," ",t.last_name]})]})]})},Z=e=>{let{content:t}=e,{group:r,contacts:n}=t;return(0,a.jsxs)(l.Z,{sx:{display:"grid",gridTemplateColumns:"40px 1fr",p:"25px",borderBottom:"1px dashed grey"},children:[(0,a.jsx)(o.Z,{variant:"h4",sx:{padding:"15px",paddingLeft:"0",aspectRatio:"1",position:"sticky",top:0},children:"misc"===r?"":r}),(0,a.jsx)(l.Z,{sx:{backgroundColor:"inherit",display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(250px, 1fr))",alignItems:"start",gap:"10px",flex:"1"},children:n.map((e,t)=>(0,a.jsx)(v,{contact:e},t))})]})};function y(){let e=(0,c.Z)(["(?<firstLetterChar>^[a-z])|"]);return y=function(){return e},e}let w=()=>{let{data:e,error:t}=(0,s.ay)("contacts"),r=[...null!=e?e:[]].reduce((e,t)=>{let r=t.first_name.match(RegExp(String.raw(y()),"i"))[0];return r?(e[r.toUpperCase()]||(e[r.toUpperCase()]=[]),e[r.toUpperCase()]=[...e[r.toUpperCase()],t]):(e.misc||(e.misc=[]),e.misc=[...e.misc,t]),e},{}),n=Object.entries(r);return(0,a.jsxs)(l.Z,{sx:{width:"100%",height:"100%"},children:[e&&n.map((e,t)=>(0,a.jsx)(Z,{content:{group:e[0],contacts:e[1]}},t)),t&&(0,a.jsx)("div",{children:"Error"})]})};var C=r(7294);let _={first_name:"Matching First Name",middle_name:"Matching Middle Name",last_name:"Matching Last Name",phone_number:"Matching Contact Number",email_address:"Matching Contact Email"},k=e=>{let{content:t}=e,{group:r,contacts:n}=t;if(_[r])return(0,a.jsxs)(l.Z,{sx:{display:"grid",gridTemplateColumns:"1fr",padding:"20px",borderBottom:"1px dashed grey"},children:[(0,a.jsx)(o.Z,{variant:"h5",sx:{},children:_[r]}),(0,a.jsx)(l.Z,{sx:{backgroundColor:"inherit",display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(250px, 1fr))",alignItems:"start",gap:"10px",flex:"1"},children:n.map((e,t)=>(0,a.jsx)(v,{contact:e},t))})]})};function E(){let e=(0,c.Z)(["",""]);return E=function(){return e},e}let{Box:R}=r(3105),U=(e,t)=>{let r=[...t].reduce((t,r)=>{for(let[a,n]of Object.entries(r))RegExp(String.raw(E(),e),"i").test(n)&&(t[a]||(t[a]=[]),t[a]=[...t[a],r]);return t},{});return r},O=()=>{let e=(0,s.C0)("ui.search.searchKeyword"),t=(0,s.C0)("contacts.data"),r=U(e,t);delete r.doc_id,delete r.profile_picture_url,delete r.date_updated,delete r.date_created,(0,s.cA)("data.searchResults",r);let n=Object.entries(r);return(0,C.useEffect)(()=>{if(1===n.length)for(let[,e]of n)(0,s.cA)("ui.activeContact",e[0]),(0,s.cA)("ui.phase.editContact",!0)},[n]),(0,a.jsx)(R,{sx:{width:"100%",height:"100%"},children:(0,a.jsx)(R,{children:n.map((e,t)=>(0,a.jsx)(k,{content:{group:e[0],contacts:e[1]}},t))})})},I=()=>{let e=(0,s.C0)("ui.phase");return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(l.Z,{sx:{flex:6.8,maxWidth:"1600px",justifyContent:"center",width:"100%",overflowY:"scroll",userSelect:"none"},children:(null==e?void 0:e.search)?(0,a.jsx)(O,{}):(0,a.jsx)(w,{})})})};var A=function(){return(0,a.jsx)(i.Z,{children:(0,a.jsx)(l.Z,{sx:{flex:1,display:"flex",flexWrap:"wrap",overflowY:"scroll",userSelect:"none",justifyContent:"center"},children:(0,a.jsx)(I,{})})})},S=r(2443),B=r(3640),J=r(8061),N=r(847),z=r(5993),F=r(9397),T=r(6154),D=r(7488),L=r(9825);let W=async e=>{let t;let r={...e};try{t=await L.I8.currentUser.getIdToken(!0)}catch(e){throw Error(e.message)}return t?r.headers.Authorization="Bearer ".concat(t):r.headers.Authorization="",r},P=async e=>{let{body:t,params:r}=e,a={headers:{}};return t&&(a.data=t),r&&(a.params=r),await W(a)};var M=r(3247);let H=async e=>{if(!e)return;let{responseType:t="arraybuffer",type:r="csv",ids:a}=e,n=await P({body:{type:r,ids:a}});return await (0,T.Z)({...n,url:"".concat("https://myphonebook-app.vercel.app","/api/contacts/export"),method:"POST",responseType:t})};var X=r(2012),q=r(6489);let G=()=>{let e=(0,S.u)(),[t,r]=(0,C.useState)("csv"),[n,i]=(0,C.useState)("all_contacts"),{data:c,loading:d,error:u}=(0,s.ay)("exportfile"),h=(0,C.useMemo)(()=>!d&&c&&!1===u?c:null,[d,c,u]);(0,C.useEffect)(()=>{if(h){let e=h.headers["content-type"],t=new Blob([h.data],{type:e}),r=document.createElement("a");r.href=URL.createObjectURL(t),r.setAttribute("download",decodeURI("contacts")),document.body.appendChild(r),r.click(),document.body.removeChild(r)}},[h]);let x=async()=>{let e={type:t};if("search_results"===n){var r,a,i;e.ids=null!==(i=null===(r=(0,s.zr)("data.searchResults"))||void 0===r?void 0:null===(a=r.sorting)||void 0===a?void 0:a.map(e=>e.doc_id))&&void 0!==i?i:[]}(0,s.Gt)("exportfile",async()=>H(e))},f=()=>{(0,s.cA)("show.exportPopup",!1),(0,s.cA)("exportfile")},m=e=>{r(e.target.value)},g=e=>{i(e.target.value)};return(0,a.jsxs)(l.Z,{id:"popupBackground",sx:{position:"fixed",zIndex:"100",top:"0",left:"0",right:"0",bottom:"0",background:"inherit",backdropFilter:"blur(5px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:e=>{"popupBackground"===e.target.id&&f()},children:[(0,a.jsxs)(p.Z,{elevation:5,sx:{padding:"30px",borderRadius:"20px",zIndex:"200",display:"flex",flexDirection:"column",backgroundColor:"hsla(10,100%,100%,50%)",maxWidth:"320px",gap:"10px"},children:[(0,a.jsx)(o.Z,{children:"Export contacts"}),(0,a.jsx)(B.Z,{disabled:d,children:(0,a.jsxs)(J.Z,{"aria-labelledby":"demo-radio-buttons-group-label",defaultValue:"google_csv",name:"radio-buttons-group",onChange:g,value:n,children:[(0,a.jsx)(N.Z,{value:"all_contacts",control:(0,a.jsx)(z.Z,{}),label:"All contacts"}),(0,a.jsx)(N.Z,{value:"search_results",control:(0,a.jsx)(z.Z,{}),label:"Search results"})]})}),(0,a.jsxs)(B.Z,{disabled:d,children:[(0,a.jsx)(o.Z,{children:"Export as"}),(0,a.jsxs)(J.Z,{"aria-labelledby":"demo-radio-buttons-group-label",defaultValue:"google_csv",name:"radio-buttons-group",onChange:m,value:t,children:[(0,a.jsx)(N.Z,{value:"csv",control:(0,a.jsx)(z.Z,{}),label:"CSV File"}),(0,a.jsx)(N.Z,{value:"pdf",control:(0,a.jsx)(z.Z,{}),label:"PDF File"})]})]}),(0,a.jsxs)(l.Z,{sx:{display:"flex",justifyContent:"flex-end"},children:[(0,a.jsx)(F.Z,{variant:"text",disabled:d,sx:{color:e.palette.primary.dark,fontWeight:"bold",minWidth:"77px"},onClick:f,children:"Cancel"}),(0,a.jsx)(F.Z,{variant:"text",disabled:d,sx:{color:e.palette.primary.dark,fontWeight:"bold",minWidth:"77px"},onClick:x,children:d?(0,a.jsx)(q.Z,{size:24}):(0,a.jsx)("span",{children:"Export"})})]})]}),"boolean"!=typeof u&&(null==u?void 0:u.message)!==""&&(0,a.jsx)(X.Z,{message:null==u?void 0:u.message})]})};var V=(0,n.Z)(function(){let e=(0,s.C0)("show.exportPopup"),t=(0,s.C0)("auth");return(0,C.useEffect)(()=>{D.q.subscribeCol("users/".concat(t.authUser.uid,"/contacts"),e=>{let t=[];e.forEach(e=>{t.push(e.data())}),(0,s.Gt)("contacts",()=>t)},(0,M.Xo)("sorting"))},[t.authUser.uid]),(0,a.jsxs)(a.Fragment,{children:[e&&(0,a.jsx)(G,{}),(0,a.jsx)(A,{})]})})}},function(e){e.O(0,[540,101,548,154,105,77,774,888,179],function(){return e(e.s=8719)}),_N_E=e.O()}]);
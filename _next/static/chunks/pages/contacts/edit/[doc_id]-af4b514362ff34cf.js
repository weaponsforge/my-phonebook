(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[18],{8192:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/contacts/edit/[doc_id]",function(){return i(1513)}])},1513:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return Z}});var l=i(5893),n=i(7294),a=i(1163),o=i(237),s=i(7488),r=i(1018),d=i(7357),u=i(1987),c=i(3972),p=i(7952),h=i(2715),m=i(9397),g=i(6489),v=i(8534),f=i(5077),_=i(8978),x=i(2012);let y="savedPhotoBlob",C={sorting:"",first_name:"",middle_name:"",last_name:"",phone_number:"",email_address:"",profile_picture_url:""},j="picturefile",b=()=>{var e,t,i,v,b;let[Z,E]=(0,n.useState)(!1),[k,w]=(0,n.useState)(null),[N,P]=(0,n.useState)(!1),[S,D]=(0,n.useState)(!1),z=(0,a.useRouter)(),{doc_id:M}=z.query,{authUser:A}=(0,o.C0)("auth"),O=(0,o.ay)("contacts"),F=(0,o.C0)(j),G=O.data.filter(e=>e.doc_id===M)[0],[R,W]=(0,n.useState)(null!=G?G:C),{loading:T,error:q,photo:H}=function(e){let t=(0,o.ay)(y);(0,n.useEffect)(()=>{let e=()=>{(0,o.Gt)(y,async()=>null,{deleteExistingData:!0})};return e(),()=>e()},[]);let i=(0,n.useMemo)(()=>null===t.data||t.loading?"":URL.createObjectURL(t.data),[t]);(0,n.useEffect)(()=>{e?(0,o.Gt)(y,async()=>(0,r.kX)(e)):(0,o.Gt)(y,async()=>null,{deleteExistingData:!0})},[e]);let l=(0,n.useMemo)(()=>{var e,i,l;return"boolean"==typeof t.error?"":null!==(l=null===(e=t.error)||void 0===e?void 0:null===(i=e.response)||void 0===i?void 0:i.data)&&void 0!==l?l:t.error.message},[t.error]);return{data:t.data,loading:t.loading,error:l,photo:i}}(""===R.profile_picture_url?null:R.profile_picture_url),I=(0,n.useMemo)(()=>{var e;return N?null!==(e=null==F?void 0:F.imgSrc)&&void 0!==e?e:"":H},[F,H,N]),J=(0,n.useMemo)(()=>""!==q?q:k||"",[k,q]);(0,n.useEffect)(()=>{S||(W(G),D(!0))},[G,S]);let L=e=>{let t=e.target.id,i=e.target.value,l={...R,[t]:i};W(l),JSON.stringify(l)===JSON.stringify(G)?E(!1):E(!0)};(0,o.cA)("contacts.loading",!0);let U=async()=>{var e,t,i,l;let n={...R,sorting:"".concat(R.first_name).concat(R.middle_name).concat(R.last_name).toUpperCase()};if(null==F?void 0:F.file)try{await (0,r.vJ)("photos/".concat(A.uid),F.file,"photo_".concat(M)),n.profile_picture_url="photos/".concat(A.uid,"/photo_").concat(M)}catch(l){let i=null!==(t=null==l?void 0:null===(e=l.response)||void 0===e?void 0:e.data)&&void 0!==t?t:l.message;i.includes("storage/unauthorized")&&(i="Photo upload failed. Please verify that the photo you are uploading is less than 1 MB in file size. Only .jpg, .jpeg, .png, .gif, .bmp and .webp image file types are supported."),w(i);return}else N&&(n.profile_picture_url="");try{await s.q.updateDoc("users/".concat(A.uid,"/contacts/").concat(M),n),z.push("/contacts")}catch(t){let e=null!==(l=null==t?void 0:null===(i=t.response)||void 0===i?void 0:i.data)&&void 0!==l?l:t.message;e.includes("Missing or insufficient permissions")&&(e="Contact update failed. Please check your input."),w(e)}},X=async()=>{try{await Promise.all([s.q.deleteDoc("users/".concat(A.uid,"/contacts/").concat(M)),(0,r.C_)({pathToStorageDirectory:"photos/".concat(A.uid),fileName:"photo_".concat(M),allowMissingError:!0})]),W(C),z.push("/contacts")}catch(i){var e,t;w(null!==(t=null==i?void 0:null===(e=i.response)||void 0===e?void 0:e.data)&&void 0!==t?t:i.message)}};return(0,l.jsxs)(f.Z,{children:[(0,l.jsx)(d.Z,{sx:{flex:"1",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",maxWidth:"100%"},children:(0,l.jsxs)(u.Z,{sx:{display:"grid",gridTemplateColumns:"1fr auto",gap:"10px",alignItems:"center",padding:"30px",borderRadius:"20px",backgroundColor:"inherit",backdropFilter:"contrast(120%)"},children:[(0,l.jsx)(c.Z,{variant:"h5",sx:{gridColumn:"1/-1"},children:"edit Contact"}),(0,l.jsxs)(d.Z,{sx:{aspectRatio:"1",gridColumn:"1/-1",position:"relative"},children:[(0,l.jsx)(p.Z,{src:I,alt:"profile_picture_url",sx:e=>({width:"342px",height:"342px",[e.breakpoints.down("400")]:{width:"100%",height:"100%"}}),children:N?null:T||""!==R.profile_picture_url?(0,l.jsx)(g.Z,{size:24,color:"info"}):null}),(0,l.jsx)(_.Z,{fileDomID:j,styles:{position:"absolute",bottom:"0",right:"0"},errorCallback:e=>w(e),clearFileCallback:()=>{N||(P(!0),E(!0))},setFileCallback:()=>{N||(P(!0),E(!0))},hasFile:""!==I})]}),(0,l.jsx)(c.Z,{variant:"h7",children:"First Name"}),(0,l.jsx)(h.Z,{id:"first_name",size:"small",inputProps:{style:{height:"20px"}},value:null!==(e=null==R?void 0:R.first_name)&&void 0!==e?e:"",onChange:L}),(0,l.jsx)(c.Z,{variant:"h7",children:"Middle Name"}),(0,l.jsx)(h.Z,{id:"middle_name",size:"small",inputProps:{style:{height:"20px"}},value:null!==(t=null==R?void 0:R.middle_name)&&void 0!==t?t:"",onChange:L}),(0,l.jsx)(c.Z,{variant:"h7",children:"Last Name"}),(0,l.jsx)(h.Z,{id:"last_name",size:"small",inputProps:{style:{height:"20px"}},value:null!==(i=null==R?void 0:R.last_name)&&void 0!==i?i:"",onChange:L}),(0,l.jsx)(c.Z,{variant:"h7",children:"Email Address"}),(0,l.jsx)(h.Z,{id:"email_address",size:"small",inputProps:{style:{height:"20px"}},value:null!==(v=null==R?void 0:R.email_address)&&void 0!==v?v:"",onChange:L}),(0,l.jsx)(c.Z,{variant:"h7",children:"Phone Number"}),(0,l.jsx)(h.Z,{id:"phone_number",size:"small",inputProps:{style:{height:"20px"}},value:null!==(b=null==R?void 0:R.phone_number)&&void 0!==b?b:"",onChange:L}),Z?(0,l.jsx)(m.Z,{variant:"contained",sx:{gridColumn:"1/-1",fontWeight:"bold"},onClick:U,children:"SAVE CHANGE"}):(0,l.jsx)(m.Z,{variant:"contained",disabled:!0,sx:{gridColumn:"1/-1",fontWeight:"bold"},children:"SAVE CHANGE"}),(0,l.jsx)(m.Z,{variant:"contained",fullWidth:!0,onClick:X,sx:{gridColumn:"1/-1",fontWeight:"bold"},children:"Delete"})]})}),J&&(0,l.jsx)(x.Z,{message:J,closeHandler:()=>w(null)})]})};var Z=(0,v.Z)(b)}},function(e){e.O(0,[642,101,548,77,412,774,888,179],function(){return e(e.s=8192)}),_N_E=e.O()}]);